# 🎭 realTimeDeepfake_based_on_WebRTC

### 📌 개요
본 프로젝트는 **WebRTC(Web Real-Time Communication) 기반의 실시간 딥페이크 영상 처리 서비스로, Roop 기술(one-shot face swap)을 활용하여 간편하게 사용자의 얼굴을 실시간으로 변환하여 스트리밍하는 기능을 제공**한다.
기존의 딥페이크 모델처럼 복잡한 학습 과정 없이, **단 하나의 이미지(reference image)만으로 즉각적인 얼굴 변환**이 가능하며, **WebRTC를 활용한 간편한 접근성과 낮은 지연 시간의 실시간 변환**이 가능하도록 설계되었다.

✅ **주요 기능**  
- **단일 이미지로 얼굴 변환**: ROOP 기능을 활용한 단일 이미지로 얼굴 변환  
- **WebRTC 스트리밍**: 낮은 지연 시간의 실시간 영상 처리  
- **P2P 및 TURN 서버 지원**: 클라우드와 같은 방화벽/NAT 환경에서도 원활한 연결  
- **웹 및 모바일 지원**: 브라우저에서 실행 가능


![설명](./processD.png)
---

### 📌 개발 목표
✅ **단일 이미지를 투입해 얼굴을 변환하는 Roop 기능으로, 간편하고 즉각적인 서비스 조작**

✅ **웹 브라우저 및 모바일에서 사용 가능한 서비스 구축**

✅ **WebRTC 기반의 낮은 지연 시간을 갖는 실시간 딥페이크 스트리밍 구현**

✅ **Distributed Data Parallel (DDP) 구현으로 다수의 GPU를 활용한 딥러닝 모델 연산 최적화**  

✅ **각 기능별 클라우드 내 서버 분리로 확장성 및 부하 분산 가능** 

<br>

### 📌 개발 작품의 필요성
- **가상 SNS 인플루언서 증가**:

  이미지 생성 AI의 발전으로 실물에 가까운 인물의 이미지 생성이 가능해졌고, 이를 통한 가상 SNS 인플루언서 시장이 증가하고 있다.  

- **인플루언서 팬 서비스 플랫폼 확대**:

  온리팬스, 라이키, 팬트리 등 크리에이터의 SNS 플랫폼 증가하였고, 1:1 메세지나 화상통화와 같은 직접적 소통을 통한 팬덤 강화가 이루어지고 있다.  

<br>

### 📌 개발 작품의 향후 개발 가능성
- **유튜브, 트위치 등 라이브 스트리밍 최적화**:

  WebRTC를 현재 유튜브와 트위치 등의 라이브 스트리밍의 API로 제공되는 RTMP 스트리밍 방식으로 빠른 변경 및 추가 서버 구현 가능

- **GPU 병렬 확장으로 이미지 변환 처리 시간 축소**:

  Distributed Data Parallel (DDP) 구현으로 다중 머신 다중 GPU 활용 및 확장 가능  

---
### 📌 개발 환경 설명
#### ✅ Hardware 구성
- **클라우드 플랫폼** : Hyperstack Cloud Platform
- **RAM** : 116GB 
- **GPU 인스턴스** : 2x L40
- **Docker / Kubernetes** (컨테이너 관리)
- **클라이언트 환경** : 웹캠 지원이 가능한 PC 및 모바일 디바이스
  
#### ✅ Software 구성
#### 1. 💻 **WebRTC 서버**
- **OS** : Windows Server 2022
- **사용 언어** : HTML, CSS, Javascript
- **스트리밍 프로토콜** : WebRTC
- **프론트엔드** : React.js
- **웹 프레임워크** : Node.js

#### 2. 📡 **Turn 서버**
- **OS** : Ubuntu Server 22.04
- **소프트웨어** : coturn

#### 3. 🖥 **AI 서버**
- **OS** : Ubuntu Server 22.04
- **사용 언어** : Python
- **딥러닝 프레임워크** : PyTorch / TensorFlow
- **딥러닝 모델** : InsightFace 
- **카메라 스트리밍 & P2P 연결** : WebRTC API

---

### 📌 Software 설계도
이 서비스는 다음과 같은 3개의 주요 서버로 구성됩니다.

1️⃣ **WebRTC 서버** – 클라이언트 간 P2P 연결 관리 및 신호 전달 (Signaling Server)  
2️⃣ **TURN 서버** – NAT/방화벽 우회 (Relay Server)  
3️⃣ **Roop 서버(딥페이크 AI 서버)** – 실시간 단일 이미지 얼굴 변환 수행 (딥페이크 모델 실행)  


### 📍 흐름도 설명
1. **클라이언트 (Broadcaster, Viewer)** 가 **웹 및 모바일 브라우저**를 통해 **WebRTC 서버 접속**
2. **클라이언트 (Broadcaster)** 가 **WebRTC 서버를 통해 시그널링 (Signaling) 및 스트리밍 서비스 송출 시작**
3. **P2P 연결 실패 시 -> TURN 서버를 거쳐** 데이터 전송
4. **WebRTC에서 캡처한 프레임을 -> 프레임 변환 Deepfake용 Roop서버로 전송**
5. **프레임 변환 서버에서 AI 변환 후 -> WebRTC 서버로 반환**
6. **변환된 프레임을 WebRTC를 통해 -> 클라이언트 B에게 전송**


![설명](./sequenceMain.png)
---
### 📌 상세 기능

#### ✅ 1. WebRTC 서버
- 클라이언트 간 시그널링 처리 (ICE Candidate 교환)
- 연결 정보를 전달하고 TURN 서버 정보를 제공

#### ✅ 2. TURN 서버 (P2P 연결 실패 시)
- 방화벽/NAT 문제로 P2P 연결이 불가능할 경우 중계 서버 역할

#### ✅ 3. Roop 프레임 변환 서버 (AI 딥페이크 서버)

![설명](./deepseq.png)

- 클라이언트에서 WebRTC로 전달된 프레임을 수신
1) 얼굴 감지(Face Detection) : 입력된 비디오나 이미지에서 얼굴을 찾아냄.
2) 얼굴 특징 매칭(Face Landmark Detection) : 얼굴의 주요 포인트(눈, 코, 입 등)를 분석하여 구조를 이해함.
3) 얼굴 변환(Face Swap) : 사용자가 업로드한 단일 이미지(reference image)의 얼굴을 기존 얼굴과 정렬 및 변형하여 적용함.
4) 후처리(Post-processing)
GFPGAN 이미지 복원 및 품질 향상 기술을 함께 사용해 자연스러운 결과를 만듦.

- 변환된 프레임을 다시 클라이언트로 전송


#### ✅ 4. WebRTC 스트리밍
- 변환된 영상이 WebRTC를 통해 상대방 클라이언트로 전달

### 📍 클래스 다이어그램

### 📍 함수별 기능

---
### 📌 개발 중 발생한 장애요인과 해결방안

---
